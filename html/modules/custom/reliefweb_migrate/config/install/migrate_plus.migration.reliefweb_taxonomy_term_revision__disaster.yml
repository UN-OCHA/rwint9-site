id: reliefweb_taxonomy_term_revision__disaster
label: Migrate ReliefWeb disaster taxonomy term revisions.
migration_group: reliefweb
dependencies:
  enforced:
    module:
      - reliefweb_migrate
source:
  plugin: reliefweb_taxonomy_term_revision
  bundle: disaster
  constants:
    bundle: disaster
    format: markdown
destination:
  plugin: entity_revision:taxonomy_term
  default_bundle: disaster
process:
  tid: tid
  vid: constants/bundle
  name: name
  description/value: description
  description/format: constants/format
  weight: weight
  changed: timestamp
  status:
    plugin: static_map
    source: field_status/0/value
    default_value: 0
    map:
      alert: 1
      current: 1
      past: 1
  # Revision information.
  revision_id: revision_id
  revision_user:
    plugin: static_map
    default_value: 2
    source: revision_user
    # Map the anonymous and super users to the System user.
    map:
      0: 2
      1: 2
  revision_log_message: revision_log_message
  revision_created: revision_created
  # Moderation status.
  moderation_state:
    plugin: static_map
    source: field_status/0/value
    default_value: draft
    map:
      draft: draft
      alert: alert
      current: ongoing
      ongoing: ongoing
      past: past
      external: external
      draft-archive: draft_archive
      alert-archive: alert_archive
      external-archive: external_archive
  # Fields.
  field_country:
    plugin: sub_process
    source: field_country
    process:
      target_id: tid
  field_primary_country:
    plugin: sub_process
    source: field_primary_country
    process:
      target_id: tid
  field_disaster_type:
    plugin: sub_process
    source: field_disaster_type
    process:
      target_id: tid
  field_primary_disaster_type:
    plugin: sub_process
    source: field_primary_disaster_type
    process:
      target_id: tid
  field_disaster_date:
    -
      plugin: skip_on_empty
      method: process
      source: field_disaster_date
    -
      plugin: sub_process
      process:
        value:
          plugin: format_date
          from_format: 'U'
          to_format: 'Y-m-d\TH:i:s'
          from_timezone: UTC
          to_timezone: UTC
          source: value
  field_glide/value:
    plugin: skip_on_empty
    method: process
    source: field_glide/0/value
  field_glide_related/value:
    plugin: skip_on_empty
    method: process
    source: field_glide_related/0/value
  field_profile/value:
    plugin: skip_on_empty
    method: process
    source: field_profile/0/value
  field_timezone/value:
    plugin: default_value
    default_value: 0
    source: field_timezone/0/value
  # # Disable path alias generation as aliases are already imported.
  # path/pathauto:
  #   plugin: default_value
  #   default_value: 0
  # path/alias:
  #   -
  #     plugin: default_value
  #     default_value: ''
  #   -
  #     plugin: skip_on_empty
  #     method: process
migration_dependencies:
  required:
    - reliefweb_taxonomy_term__disaster
