id: reliefweb_node
label: ReliefWeb Migration - Nodes
description: Migrate ReliefWeb nodes from Drupal 7 to Drupal 9.
source_type: Drupal 7
shared_configuration:
  migration_tags:
    - node
  dependencies:
    enforced:
      module:
        - reliefweb_migrate
  source:
    key: rwint7
    plugin: reliefweb_node
    constants:
      format: markdown
  destination:
    plugin: entity:node
  process:
    # Base properties.
    nid: nid
    uid:
      plugin: static_map
      bypass: true
      source: uid
      # Map the anonymous and super users to the System user.
      map:
        0: 2
        1: 2
    type:
      plugin: static_map
      bypass: true
      source: type
      map:
        announcement: announcement
        blog_post: blog_post
        book: book
        job: job
        report: report
        topic: topic
        topics: topic
        training: training
    # We let the system set the default language (en).
    # langcode: en
    # We skip the sticky and promote values as they are not used. They will be
    # resetted to 0.
    # sticky: sticky
    # promote: promote
    title: title
    created: created
    changed: changed
    # Publication status.
    status:
      plugin: static_map
      source: field_status/0/value
      default_value: 0
      map:
        published: 1
        to-review: 1
    # Moderation status.
    moderation_state:
      plugin: static_map
      source: field_status/0/value
      default_value: draft
      map:
        archive: archive
        draft: draft
        duplicate: duplicate
        expired: expired
        embargoed: embargoed
        on-hold: on_hold
        pending: pending
        published: published
        reference: reference
        refused: refused
        to-review: to_review
    # Revision information.
    vid: revision_id
    revision_uid:
      plugin: static_map
      bypass: true
      source: revision_user
      # Map the anonymous and super users to the System user.
      map:
        0: 2
        1: 2
    revision_log: revision_log_message
    revision_timestamp: revision_created
    revision_default: revision_default
    # Fields.
    body/value:
      plugin: skip_on_empty
      method: process
      source: body/0/value
    body/format:
      plugin: static_map
      default_value: markdown
      map:
        full_html: html
        legacy: markdown
        markdown: markdown
        plain_text: markdown
        token_markdown: token_markdown
    # Disable notifications.
    notifications_content_disable:
      plugin: default_value
      default_value: 1
  migration_dependencies:
    required:
      - reliefweb_user
      - reliefweb_media__image_announcement
      - reliefweb_media__image_blog_post__field_attached_images
      - reliefweb_media__image_blog_post__field_image
      - reliefweb_media__image_headline
      - reliefweb_media__image_report
      - reliefweb_taxonomy_term
      - reliefweb_taxonomy_term__country
      - reliefweb_taxonomy_term__disaster
      - reliefweb_taxonomy_term__source
dependencies:
  enforced:
    module:
      - reliefweb_migrate
