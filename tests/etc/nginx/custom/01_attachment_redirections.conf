## Public attachments.
location /attachments/ {
  ## Use our custom 404 handler so we can set the content disposition
  ## to inline to prevent the browser from downloading a file with the
  ## "404 Not Found" message.
  error_page 404 @attachment-404;

  ## Pass the request to drupal.
  try_files @drupal =404;
}

## Private attachments.
location /private/attachments/ {
  ## Use our custom 404 handler so we can set the content disposition
  ## to inline to prevent the browser from downloading a file with the
  ## "404 Not Found" message.
  error_page 404 @attachment-404;

  ## Pass the request to drupal.
  try_files @drupal =404;
}

## 404 handler for attachments that prevent browsers from downloading a file
## with the attachment file name but containing a "404 Not Found" message.
location @attachment-404 {
  add_header Content-Type 'text/plain' always;
  add_header Content-Disposition 'inline' always;
  return 404 "404 Not Found";
}
